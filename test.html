<head>
    <!--
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
    <script src="load_graph.js"></script>
    -->
    <script src="http://d3js.org/d3.v3.min.js"></script> 
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    
</head>

<body>
    <div id="chart"/>
</body>

<!-- Load Graph -->
<script src="dynamic_graph_pos.js"></script> 

<script>
    var width = $(window).width(),
        height = $(window).height();

    var zoom = d3.behavior.zoom()
            .scaleExtent([1, 10])
            .on("zoom", zoomed);

    function zoomed() {
        svg.attr("transform",
            "translate(" + d3.event.translate + ")"
            + " scale(" + d3.event.scale + ")");
    };
    
    var svg = d3.select("#chart")
          .append("svg")
          .attr("id", "network")
          .attr("width", width)    
          .attr("height", height)
          .attr("viewBox","0 0 "+ width + " " + height)
          .attr("preserveAspectRatio","xMidYMid")
          .call(zoom)
          .on("dblclick.zoom", null)          
        .append('g');
    
    /*
    var link = svg.selectAll(".link")
        .data(graph.links)
        .enter().append("line")
        .attr("class", "link")
        .attr("x1", function(d) { return d.source.cx; })
        .attr("y1", function(d) { return d.source.cy; })
        .attr("x2", function(d) { return d.target.cx; })
        .attr("y2", function(d) { return d.target.cy; })
        ;
    */
    
        
    var node = svg.selectAll("g.node")
        .data(graph.nodes)
        .enter().append("g")
        .attr("class", "node")
        .attr("id",function(d) { return 'x' + d.Name;})
        .on("mouseup", function(d){mouseUp(d)})
        .on("mousedown", function(d){mouseDown(d)})
        .on("contextmenu", function(d) {rightClick(d)} )
        .on("dblclick", function(d) {doubleClick(d)})
        //.call(drag)
        ;  
    
    node.append("circle")
        .attr("class", "node")
        .attr("id",function(d) { return 'x' + d.Name;})
        .attr("cx",function(d) { return d.cx * width;})
        .attr("cy",function(d) { return d.cy * height;})
        .attr("r", 12)
        .style("opacity", .1)
        ;
    
    // Demo with arbitrary snapshot
    var snap = 1428537600
    for(i=0;i<graph.edges.length;i++){
        for(j=0; j<graph.edges[i].snapshots.length; j++){
            //console.log(graph.edges[i].snapshots[j]);
            if(snap == graph.edges[i].snapshots[j][0]){
                //d3.select('circle.node#' + graph.edges[i].source).attr('fill', 'red');
                //d3.select('circle.node#' + graph.edges[i].target).attr('fill', 'red');
                d3.select('circle.node#x' + graph.edges[i].source).style("opacity", 1).attr('fill', 'red');
                d3.select('circle.node#x' + graph.edges[i].target).style("opacity", 1).attr('fill', 'red');
                //console.log(i,j);
            }
        }
    }
    
</script>